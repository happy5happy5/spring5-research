<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Title</title>
</head>
<body>
<div th:fragment="sidebar">
    <div class="sidebar-container position-absolute top-0 overflow-hidden d-flex flex-column vh-100 flex-shrink-0 py-3 text-white ">
        <!--        sidebar header-->
        <div class="align-items-center m-0 mt-3 text-white text-decoration-none row">

            <h5 class=" ms-5 col">Create</h5>

        </div>
        <hr>
        <!--        sidebar body-->
        <ul class="sidebar">
            <li class="sidebar-item" onclick="handleSidebarItemClick(this)">
                <!--                data part-->
                <div data-input="data" class="data-type-input">
                    <button onclick="saveHTML(this)">save</button>
                    <button onclick="loadHTML(this)">load</button>
                    <div class="saveData" style="display: none"></div>
                    <div class="saveHTML" style="display: none"></div>
                    <script>
                        function saveHTML(e){
                        //        main-content-container
                            let mainContentContainer = document.querySelector('#layout-content .main-content-container');
                            let mainContentContainerHTML = mainContentContainer.innerHTML;
                            let textareas =[];
                            mainContentContainer.querySelectorAll('textarea').forEach(function (item){
                                textareas.push(item.value);
                            });
                            textareas = JSON.stringify(textareas);
                            // <div data-input="data" class="data-type-input"> 의 자식 요소중 saveData 를 찾습니다.
                            let saveData = e.parentElement.querySelector('.saveData');
                            let saveHTML = e.parentElement.querySelector('.saveHTML');
                            saveData.value = textareas;
                            saveHTML.value = mainContentContainerHTML;
                            // console.log(saveData.value);
                            // console.log(saveHTML.value);

                        }
                        function loadHTML(e){
                            let mainContentContainer = document.querySelector('#layout-content').querySelector('.main-content-container')
                            let saveData = e.parentElement.querySelector('.saveData');
                            let saveHTML = e.parentElement.querySelector('.saveHTML');
                            let textareas = JSON.parse(saveData.value);
                            mainContentContainer.innerHTML = saveHTML.value;
                            let textareasInMainContentContainer = mainContentContainer.querySelectorAll('textarea');
                            textareasInMainContentContainer.forEach(function (item, index){
                                item.value = textareas[index];
                            });
                        }
                    </script>
                </div>


                <div class="nav-link text-white col ps-0 d-flex justify-content-between align-items-center" aria-current="page">
                    <span class="item-numbering">Q0</span>
                    <span class="item-title ms-2">제목제목제목</span>
                    <div class="btn-group" onclick="stopPropagation(event)">
                        <!-- popper button -->
                        <div type="button" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" onclick="stopPropagation(event)">
                            <i></i>
                        </div>
                        <ul class="dropdown-menu" onclick="stopPropagation(event)">
                            <li>
                                <div class="ms-3">기능</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <!--                         0: 객관식 1: OX 2: likert 3: 주관식 4: 별점 5: 다중선택        -->
                            <li>
                                <div class="dropdown-item" data-type="0" onclick="handleSideBarCreatButtonByType(this)">객관식</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="1" onclick="handleSideBarCreatButtonByType(this)">OX</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="2" onclick="handleSideBarCreatButtonByType(this)">LIKERT</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="3" onclick="handleSideBarCreatButtonByType(this)">주관식</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="4" onclick="handleSideBarCreatButtonByType(this)">별점</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="5" onclick="handleSideBarCreatButtonByType(this)">다중선택 객관식</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="delete" onclick="handleSideBarCreatButtonByType(this)">삭제</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
        </ul>

    </div>
    <!--Make SideBar Element-->
    <script>

        function handleSideBarCreatButtonByType(element) {

            // save content HTML and data when create new element
            let currentElNum = document.querySelector('#layout-content #question-number span').textContent;
            saveContentActionWhenCreateNewEl(currentElNum);


            const currentLiEl = element.closest('.sidebar-item');
            const parentUlEl = currentLiEl.closest('.sidebar');
            // console.log(parentLiEl);
            // UlEl의 parentLiEl의 index를 찾습니다.
            const index = Array.prototype.indexOf.call(parentUlEl.children, currentLiEl);
            // console.log(index);
            // parentUlEl 의 index+1 번째에 새로운 li 요소를 만듭니다.
            const type = element.dataset.type;
            // newLiEL 에 type 따라서 다른 html 넣어줍니다.
            switch (type) {
                // 0: 객관식 1: OX 2: likert 3: 주관식 4: 별점 5: 다중선택
                case '0' :
                    createSideBarElementByType(parentUlEl, index, type, '');
                    setQNumWhenAddOnSideBar(parentUlEl);
                    // 여기서 main-content-container 에 element를 추가해줍니다.
                    createMainContentElementType0(index, type, '');
                    console.log('객관식')
                    break;
                case '1' :
                    console.log('OX')
                    break;
                case '2' :
                    console.log('likert')
                    break;
                case '3' :
                    console.log('주관식')
                    break;
                case '4' :
                    console.log('별점')
                    break;
                case '5' :
                    console.log('다중선택')
                    break;
                case 'delete' :
                    console.log('삭제')
                    // index 번째의 li 요소를 삭제합니다.
                    if(index === 0){
                        alert('첫번째 항목은 삭제할 수 없습니다.')
                        return;
                    }
                    parentUlEl.removeChild(parentUlEl.children[index]);
                    setQNumWhenDeleteOnSideBar(parentUlEl);
                    break;
            }


            if (currentLiEl) {

            } else {
                alert('부모 요소의 data-list 찾을 수 없습니다. 상황이 심각 합니다');
            }
        }

        function createSideBarElementByType(parentUlEl, index, type,title) {
        //     sidebar-item 를 만든다
        //     리터럴 형식으로?
            let newLiEl =
            `
            <li class="sidebar-item" draggable="true" onclick="handleSidebarItemClick(this)">
                <div data-input="data" class="data-type-input">

                    <!--                    여기에 필요 한 모든 입력값 저장 한다-->
                    <!--                    0: 객관식 1: OX 2: likert 3: 주관식 4: 별점 5: 다중선택 -->
                    <div class="rsiType" style="display: none">${type}</div>
                    <div class="saveData" style="display: none"></div>
                    <div class="saveHTML" style="display: none"></div>
                </div>


                <div class="nav-link text-white col ps-0 d-flex justify-content-between align-items-center" aria-current="page">
                    <span class="item-numbering"></span>
                    <span class="item-title ms-2">${title}</span>
                    <div class="btn-group" onclick="stopPropagation(event)">
                        <!-- popper button -->
                        <div type="button" class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i></i>
                        </div>
                        <ul class="dropdown-menu">
                            <li>
                                <div class="ms-3">기능</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <!--                         0: 객관식 1: OX 2: likert 3: 주관식 4: 별점 5: 다중선택        -->
                            <li>
                                <div class="dropdown-item" data-type="0" onclick="handleSideBarCreatButtonByType(this)">객관식</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="1" onclick="handleSideBarCreatButtonByType(this)">OX</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="2" onclick="handleSideBarCreatButtonByType(this)">LIKERT</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="3" onclick="handleSideBarCreatButtonByType(this)">주관식</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="4" onclick="handleSideBarCreatButtonByType(this)">별점</div>
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="5" onclick="handleSideBarCreatButtonByType(this)">다중선택 객관식</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <div class="dropdown-item" data-type="delete" onclick="handleSideBarCreatButtonByType(this)">삭제</div>
                            </li>

                        </ul>
                    </div>
                </div>
            </li>
            `
            newLiEl = htmlToElement(newLiEl);
            addDragAndDropEvent(newLiEl);
            parentUlEl.insertBefore(newLiEl, parentUlEl.children[index + 1]);
        }

        function createMainContentElementType0(index, type, title) {
            let newMainContentEl =
            `
            <div class="d-flex col">
                <div id="question-number" class="col-1 d-flex justify-content-end me-3">
                    <span>${index+1}</span>
                    <span>-></span>
                </div>

                <div class="col-11 pe-5">
                    <label>
                        <textarea placeholder="질문을 입력하세요" oninput="handleQuestionItemType0Input(this)"></textarea>
                    </label>

                    <ul class="question-list m-0 p-0">
<!--                        <li class="question-item d-flex col justify-content-evenly" draggable="true">-->
<!--                            <div class="item-numbering col-1">1</div>-->
<!--                            <textarea class="col-8" placeholder="보기를 입력하세요" oninput="handleQuestionItemType0Input(this)"></textarea>-->
<!--                            <button class="question-item-delete col-1 btn btn-toolbar shadow-none bg-transparent" onclick="handleQuestionItemDeleteButtonClick(this)">-->
<!--                                <span>del</span>-->
<!--                            </button>-->
<!--                        </li>-->
                    </ul>
                    <div onclick="handleQuestionAddButtonOnMainContent(this)">질문 추가</div>

                </div>

            `
            newMainContentEl = htmlToElement(newMainContentEl);
            // addDragAndDropEvent(newMainContentEl);
            let mainContentDiv = document.querySelector('#layout-content').querySelector('.main-content')
            // console.log(mainContentDiv)
            // todo: 여기에서 애니메이션 용 클래스를 추가
        //     mainContentDiv 의 내용 삭제 후 newMainContentEl 을 추가 합니다.
            mainContentDiv.innerHTML = '';
            mainContentDiv.appendChild(newMainContentEl);
        }

        function createMainContentElementType1(index, type, title){
            let newMainContentEl =
                `

            `
        }

        function createMainContentElementType2(index, type, title){
            let newMainContentEl =
                `

            `
        }

        function createMainContentElementType3(index, type, title){
            let newMainContentEl =
                `

            `
        }

        function createMainContentElementType4(index, type, title){
            let newMainContentEl =
                `

            `
        }
        function createMainContentElementType5(index, type, title){
            let newMainContentEl =
                `

            `
        }

    </script>

</div>

</body>
</html>